{"ID":"6a9bfa67-d8de-4ad9-a66b-be7802a237b5","VersionNumber":0,"Name":"Low Thread Count","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csC99C0427{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;text-decoration: underline;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This is not a warning about the lack of quality bedding in your hotel while at a conference. This alert warns you when SQL Server is running low on available worker threads.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This Advisory Condition will check to see how many worker threads are possible in your SQL Server, then deduct the amount used to provide available threads for use.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">The number of available threads is then checked to see if it is less than or equal to 5% of the total threads. If this is returned as true then the alert will fire.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">If you wish to change the percentage then this can be done by changing the query being compared against.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csC99C0427\">Resolutions</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">It is possible to change the number of workers available in SQL Server but this is generally not advised (as per Microsoft Documentation - <a class=\"cs6BD174F1\" href=\"https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-max-worker-threads-server-configuration-option?view=sql-server-ver15\"><span class=\"csC1A17A41\">https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-max-worker-threads-server-configuration-option?view=sql-server-ver15</span></a></span><span class=\"csBEC5BAA2\">)</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Instead you should see what is using the active threads and tune the statements involved to improve concurrency. Please go to the Top SQL tab to see what queries were running during the timeframe this alert fired.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Further Reading on threads - <a class=\"cs6BD174F1\" href=\"https://docs.microsoft.com/en-us/sql/relational-databases/thread-and-task-architecture-guide\"><span class=\"csC1A17A41\">https://docs.microsoft.com/en-us/sql/relational-databases/thread-and-task-architecture-guide</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @MaxWorkers INT;\\r\\nSELECT  @MaxWorkers = dosi.max_workers_count\\r\\nFROM    sys.dm_os_sys_info dosi;\\r\\n\\r\\nSELECT \\r\\n\\t\\t@MaxWorkers - SUM(dos.active_workers_count) AS [AvailableThreads] \\r\\n/*\\r\\n\\t\\t@MaxWorkers AS 'TotalThreads', \\r\\n\\t\\tSUM(dos.active_Workers_count) AS [CurrentThreads],        \\r\\n\\t\\tSUM(dos.runnable_tasks_count) AS [WorkersWaitingForCpu], \\r\\n\\t\\tSUM(dos.work_queue_count) AS [RequestWaitingForThreads], \\r\\n\\t\\tSUM(dos.current_workers_count) AS [AssociatedWorkers],\\r\\n\\t\\tGETDATE() AS 'CurrentDate'\\r\\n*/\\r\\nFROM sys.dm_os_Schedulers dos\\r\\nWHERE   dos.[status] = 'VISIBLE ONLINE';\\r\\n\",\"InstanceType\":0},\"ComparisonType\":5,\"Right\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT  (dosi.max_workers_count/100) * 5\\r\\nFROM    sys.dm_os_sys_info dosi;\",\"InstanceType\":0},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:02:00","IdlePeriod":"00:01:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"fde5d447-094f-4db0-98d8-9a1c34142aa4","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":"8.0","MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":1,"ColorIndicator":null,"Severity":2,"Signature":{"ConditionID":"6a9bfa67-d8de-4ad9-a66b-be7802a237b5","VersionNumber":0,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @MaxWorkers INT;\\r\\nSELECT  @MaxWorkers = dosi.max_workers_count\\r\\nFROM    sys.dm_os_sys_info dosi;\\r\\n\\r\\nSELECT \\r\\n\\t\\t@MaxWorkers - SUM(dos.active_workers_count) AS [AvailableThreads] \\r\\n/*\\r\\n\\t\\t@MaxWorkers AS 'TotalThreads', \\r\\n\\t\\tSUM(dos.active_Workers_count) AS [CurrentThreads],        \\r\\n\\t\\tSUM(dos.runnable_tasks_count) AS [WorkersWaitingForCpu], \\r\\n\\t\\tSUM(dos.work_queue_count) AS [RequestWaitingForThreads], \\r\\n\\t\\tSUM(dos.current_workers_count) AS [AssociatedWorkers],\\r\\n\\t\\tGETDATE() AS 'CurrentDate'\\r\\n*/\\r\\nFROM sys.dm_os_Schedulers dos\\r\\nWHERE   dos.[status] = 'VISIBLE ONLINE';\\r\\n\",\"InstanceType\":0},\"ComparisonType\":5,\"Right\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT  (dosi.max_workers_count/100) * 5\\r\\nFROM    sys.dm_os_sys_info dosi;\",\"InstanceType\":0},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2021-02-16T10:12:35","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"V3BwJRpacVzONispsJs666XxlZleszM1V/uqIRqyWQ50mrSSXcKF4vwfD2BMWBDDX0ygtQMVRxsVczQuIWjRO2Y2DDGnuS6DNU6mW3wzTMVXJMIHOyqZZknCm70qb1rEbcz8Y9h4AG/nX/iglXQfhOgYrdZmrvxYTkURzYHhykM=","IsSelfPublishedCondition":true},"Tags":null,"Areas":["SQL Server: Activity"],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}