{"ID":"a006a5fc-2f9b-4a19-82e1-eb06393b3466","VersionNumber":5,"Name":"Availability Replicas Hosted on Same Virtual Host","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csF6EF92FE{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This condition evaluates to True when multiple Availability Replicas from the same Availability Group are hosted on the same VMware/Hyper-V host.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">In the event of an issue with the Host server, there could be an outage that nullifies the Always On Availability Group configuration within the Virtual Machines hosted on the VMware Infrastructure.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csF6EF92FE\">See Also</span><span class=\"csBEC5BAA2\">:</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"https://blogs.sentryone.com/johnmartin/always_on_availabilitygroupsandvms/\"><span class=\"csC1A17A41\">https://blogs.sentryone.com/johnmartin/always_on_availabilitygroupsandvms/</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"f2e88d72-73c6-4ce1-b92a-029c313e707f\",\"Query\":\"--// AG Replicas on the same VM host\\r\\n--// Applies to : VMware & Hyper-V\\r\\n--// ConditionKey column breakdown as follows;\\r\\n--// Host : {VMwareHost Name} | WSFC : {Windows Cluster Name} | AG : {AG Name} - {AG Replicas on Host}\\r\\nSELECT\\r\\n\\t 'Host : ' + QUOTENAME(HS1.Name) + ' | WSFC : ' + CR.ClusterName + ' | AG : ' +  AG1.Name + ' - ' +\\r\\n\\t\\t STUFF((SELECT N', ' + QUOTENAME(NodeName) + '(' + CASE Role WHEN 1 THEN 'P' ELSE 'S' END + ')'\\r\\n\\t\\t\\t\\tFROM AlwaysOn.AvailabilityReplica AS AR2\\r\\n\\t\\t\\t\\tINNER JOIN VM.VirtualMachine AS VM2\\r\\n\\t\\t\\t\\t   ON AR2.NodeName = VM2.Name\\r\\n\\t\\t\\t\\tWHERE AR2.GroupID = AR1.GroupID\\r\\n\\t\\t\\t\\t  AND VM2.HostSystemID = VM1.HostSystemID\\r\\n\\t\\t\\t\\tORDER BY Role, NodeName\\r\\n  \\t\\t\\t\\tFOR XML PATH(N''), TYPE).value(N'.[1]', N'nvarchar(max)'), 1, 2, N'') as ConditionKey\\r\\n\\t,COUNT(VM1.Name) AS ReplicaCount\\r\\nFROM VM.HostSystem HS1\\r\\nINNER JOIN VM.VirtualMachine AS VM1\\r\\n\\tON HS1.ID = VM1.HostSystemID\\r\\nINNER JOIN AlwaysOn.AvailabilityReplica AR1\\r\\n\\tON AR1.NodeName = VM1.Name\\r\\nINNER JOIN AlwaysOn.AvailabilityGroup AS AG1\\r\\n\\tON AG1.GroupID = AR1.GroupID\\r\\nINNER JOIN AlwaysOn.ClusterReference CR\\r\\n\\tON AR1.EventSourceConnectionID = CR.EventSourceConnectionID\\r\\nGROUP BY\\r\\n\\t CR.ClusterName\\r\\n\\t,AR1.GroupID\\r\\n\\t,AG1.Name\\r\\n\\t,VM1.HostSystemID\\r\\n\\t,HS1.Name\\r\\nHAVING COUNT(VM1.Name) > 1\\r\\nORDER BY CR.ClusterName, AG1.Name, HS1.Name\\r\\n;\",\"InstanceType\":1},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:05:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"75c7d02b-f009-4f01-883c-6ac7f365f391","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":100,"ColorIndicator":null,"Severity":2,"Signature":{"ConditionID":"a006a5fc-2f9b-4a19-82e1-eb06393b3466","VersionNumber":5,"AppliesToObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"f2e88d72-73c6-4ce1-b92a-029c313e707f\",\"Query\":\"--// AG Replicas on the same VM host\\r\\n--// Applies to : VMware & Hyper-V\\r\\n--// ConditionKey column breakdown as follows;\\r\\n--// Host : {VMwareHost Name} | WSFC : {Windows Cluster Name} | AG : {AG Name} - {AG Replicas on Host}\\r\\nSELECT\\r\\n\\t 'Host : ' + QUOTENAME(HS1.Name) + ' | WSFC : ' + CR.ClusterName + ' | AG : ' +  AG1.Name + ' - ' +\\r\\n\\t\\t STUFF((SELECT N', ' + QUOTENAME(NodeName) + '(' + CASE Role WHEN 1 THEN 'P' ELSE 'S' END + ')'\\r\\n\\t\\t\\t\\tFROM AlwaysOn.AvailabilityReplica AS AR2\\r\\n\\t\\t\\t\\tINNER JOIN VM.VirtualMachine AS VM2\\r\\n\\t\\t\\t\\t   ON AR2.NodeName = VM2.Name\\r\\n\\t\\t\\t\\tWHERE AR2.GroupID = AR1.GroupID\\r\\n\\t\\t\\t\\t  AND VM2.HostSystemID = VM1.HostSystemID\\r\\n\\t\\t\\t\\tORDER BY Role, NodeName\\r\\n  \\t\\t\\t\\tFOR XML PATH(N''), TYPE).value(N'.[1]', N'nvarchar(max)'), 1, 2, N'') as ConditionKey\\r\\n\\t,COUNT(VM1.Name) AS ReplicaCount\\r\\nFROM VM.HostSystem HS1\\r\\nINNER JOIN VM.VirtualMachine AS VM1\\r\\n\\tON HS1.ID = VM1.HostSystemID\\r\\nINNER JOIN AlwaysOn.AvailabilityReplica AR1\\r\\n\\tON AR1.NodeName = VM1.Name\\r\\nINNER JOIN AlwaysOn.AvailabilityGroup AS AG1\\r\\n\\tON AG1.GroupID = AR1.GroupID\\r\\nINNER JOIN AlwaysOn.ClusterReference CR\\r\\n\\tON AR1.EventSourceConnectionID = CR.EventSourceConnectionID\\r\\nGROUP BY\\r\\n\\t CR.ClusterName\\r\\n\\t,AR1.GroupID\\r\\n\\t,AG1.Name\\r\\n\\t,VM1.HostSystemID\\r\\n\\t,HS1.Name\\r\\nHAVING COUNT(VM1.Name) > 1\\r\\nORDER BY CR.ClusterName, AG1.Name, HS1.Name\\r\\n;\",\"InstanceType\":1},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2016-10-27T19:56:41","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"CVOrttRoQHXTUDrfPfjViFTJk7RmKOLtc+ZZDSYD8O4Lvk32bnkkMS/CHx0FidTVA/owk/WkrsaZuFP3Zp2olhL2SnzM/jtyx+1OuaQdqIYvob+9K2wYhm1miFlm/OWlkGmNDSuXS++SNpb0IfVGbI33Xw0wfrd8sCy7pN8qD1k=","IsSelfPublishedCondition":true},"Tags":"HA/DR,Hyper-V,Virtualization,VMware,UpdateForPublish,11.2.3","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}