{"ID":"539d97cc-27ba-4ad0-8d97-b804b0d4fa2e","VersionNumber":9,"Name":"Check Constraints Not Trusted","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csF6EF92FE{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This condition evaluates to True when it finds sys.check_constraints.is_not_trusted values on objects that it expects to be trusted.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">When check constraints are not trusted, SQL Server may not be able to use them for query plans and optimization, affecting the performance of your queries. Check constraints that were disabled, perhaps for bulk loading of data, and then enabled, may not be trusted. &nbsp;The table must be altered for those check constraints to be trusted again.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csF6EF92FE\">See Also</span><span class=\"csBEC5BAA2\">:</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"http://blogs.sqlsentry.com/melissaconnors/does-your-database-have-trust-issues\"><span class=\"csC1A17A41\">http://blogs.sqlsentry.com/melissaconnors/does-your-database-have-trust-issues</span></a></span></p><p class=\"cs2654AE3A\"><a href=\"http://blogs.sqlsentry.com/melissaconnors/does-your-database-have-trust-issues\"></a><span class=\"csBEC5BAA2\">&nbsp;</span><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @sql nvarchar(max);\\r\\nSET @sql = N'';\\r\\nSELECT @sql = @sql + N'UNION ALL \\r\\n  SELECT DBName = N''' + name + ''' COLLATE Latin1_General_BIN, \\r\\n  CCsNotTrusted =  \\r\\n  (\\r\\n    SELECT COUNT(*) AS CCsNotTrusted\\r\\n      FROM ' + QUOTENAME(name) + '.sys.check_constraints AS c'\\r\\n      + N'\\r\\n      WHERE c.is_not_trusted = 1 \\r\\n        AND c.is_not_for_replication = 0 \\r\\n        AND c.is_disabled = 0\\r\\n  )\\r\\n  ' FROM sys.databases \\r\\nWHERE database_id > 4 AND state = 0;\\r\\nSET @sql = N'SELECT DBName, CCsNotTrusted FROM \\r\\n(' + STUFF(@sql, 1, 10, N'') \\r\\n   + N') AS x WHERE CCsNotTrusted > 0;';\\r\\nEXEC sys.sp_executesql @sql;\",\"InstanceType\":1},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"0\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"1.00:00:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:30","AntiConditionID":"ffdde483-c23d-48ea-9a38-5b00dda003a7","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":"10.0","MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":100,"ColorIndicator":null,"Severity":1,"Signature":{"ConditionID":"539d97cc-27ba-4ad0-8d97-b804b0d4fa2e","VersionNumber":9,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @sql nvarchar(max);\\r\\nSET @sql = N'';\\r\\nSELECT @sql = @sql + N'UNION ALL \\r\\n  SELECT DBName = N''' + name + ''' COLLATE Latin1_General_BIN, \\r\\n  CCsNotTrusted =  \\r\\n  (\\r\\n    SELECT COUNT(*) AS CCsNotTrusted\\r\\n      FROM ' + QUOTENAME(name) + '.sys.check_constraints AS c'\\r\\n      + N'\\r\\n      WHERE c.is_not_trusted = 1 \\r\\n        AND c.is_not_for_replication = 0 \\r\\n        AND c.is_disabled = 0\\r\\n  )\\r\\n  ' FROM sys.databases \\r\\nWHERE database_id > 4 AND state = 0;\\r\\nSET @sql = N'SELECT DBName, CCsNotTrusted FROM \\r\\n(' + STUFF(@sql, 1, 10, N'') \\r\\n   + N') AS x WHERE CCsNotTrusted > 0;';\\r\\nEXEC sys.sp_executesql @sql;\",\"InstanceType\":1},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"0\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2016-07-19T21:33:25","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"eEH0Bj2019g7dfreiLGbaYxUOi3uIVUqB8mqNcXz+l6yVOo/ZFymguHhRNzJQYaGbWnAJjruhQMZvre49mapkkVgNDiXZgcqJdu2LSBZChx1/qUt3GwZ5oJz2k5nTd48I2jZiny+f/wbQ1PW/vg0VbevGvQj/xdhF2EcsEYLaw4=","IsSelfPublishedCondition":true},"Tags":"Performance","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}
